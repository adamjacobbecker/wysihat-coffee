var WysiHat;WysiHat={},$.fn.wysihat=function(){var e;return e=void 0,this.each(function(){var t;return t=WysiHat.Editor.attach($(this)),t.toolbar=new WysiHat.Toolbar(t),$(this).data("wysihat",e)})};var DOMUtils;window.getSelection||(DOMUtils={isDataNode:function(e){try{return e&&e.nodeValue!==null&&e.data!==null}catch(t){return!1}},isAncestorOf:function(e,t){return e?!DOMUtils.isDataNode(e)&&(e.contains(DOMUtils.isDataNode(t)?t.parentNode:t)||t.parentNode===e):!1},isAncestorOrSelf:function(e,t){return DOMUtils.isAncestorOf(e,t)||e===t},findClosestAncestor:function(e,t){if(DOMUtils.isAncestorOf(e,t))while(t&&t.parentNode!==e)t=t.parentNode;return t},getNodeLength:function(e){return DOMUtils.isDataNode(e)?e.length:e.childNodes.length},splitDataNode:function(e,t){var n;return DOMUtils.isDataNode(e)?(n=e.cloneNode(!1),e.deleteData(t,e.length),n.deleteData(0,t),e.parentNode.insertBefore(n,e.nextSibling)):!1}},window.Range=function(){var e,t,n;return e=function(e){return this._document=e,this.startContainer=this.endContainer=e.body,this.endOffset=DOMUtils.getNodeLength(e.body)},n=function(e){var t;t=0;while(e=e.previousSibling)continue;return t},t=function(e){var t;this.range=e;if(e.collapsed)return;return t=e.commonAncestorContainer,this._next=e.startContainer===t&&!DOMUtils.isDataNode(e.startContainer)?e.startContainer.childNodes[e.startOffset]:DOMUtils.findClosestAncestor(t,e.startContainer),this._end=e.endContainer===t&&!DOMUtils.isDataNode(e.endContainer)?e.endContainer.childNodes[e.endOffset]:DOMUtils.findClosestAncestor(t,e.endContainer).nextSibling},e.START_TO_START=0,e.START_TO_END=1,e.END_TO_END=2,e.END_TO_START=3,e.prototype={startContainer:null,startOffset:0,endContainer:null,endOffset:0,commonAncestorContainer:null,collapsed:!1,_document:null,_toTextRange:function(){var e,t;return e=function(e,t,n){var r,i,s,o,u,a,f;s=t[n?"startContainer":"endContainer"],a=t[n?"startOffset":"endOffset"],f=0,r=DOMUtils.isDataNode(s)?s:s.childNodes[a],i=DOMUtils.isDataNode(s)?s.parentNode:s;if(s.nodeType===3||s.nodeType===4)f=a;return u=t._document.createElement("a"),r?i.insertBefore(u,r):i.appendChild(u),o=t._document.body.createTextRange(),o.moveToElementText(u),u.parentNode.removeChild(u),e.setEndPoint(n?"StartToStart":"EndToStart",o),e[n?"moveStart":"moveEnd"]("character",f)},t=this._document.body.createTextRange(),e(t,this,!0),e(t,this,!1),t},_refreshProperties:function(){var e;this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset,e=this.startContainer;while(e&&e!==this.endContainer&&!DOMUtils.isAncestorOf(e,this.endContainer))e=e.parentNode;return this.commonAncestorContainer=e},setStart:function(e,t){return this.startContainer=e,this.startOffset=t,this._refreshProperties()},setEnd:function(e,t){return this.endContainer=e,this.endOffset=t,this._refreshProperties()},setStartBefore:function(e){return this.setStart(e.parentNode,n(e))},setStartAfter:function(e){return this.setStart(e.parentNode,n(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,n(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,n(e)+1)},selectNode:function(e){return this.setStartBefore(e),this.setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0),this.setEnd(e,DOMUtils.getNodeLength(e))},collapse:function(e){return e?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)},cloneContents:function(){var e;return(e=function(t){var n,r;r=void 0,n=document.createDocumentFragment();while(r=t.next())r=r.cloneNode(!t.hasPartialSubtree()),t.hasPartialSubtree()&&r.appendChild(e(t.getSubtreeIterator())),n.appendChild(r);return n})(new t(this))},extractContents:function(){var e,n;return n=this.cloneRange(),this.startContainer!==this.commonAncestorContainer&&this.setStartAfter(DOMUtils.findClosestAncestor(this.commonAncestorContainer,this.startContainer)),this.collapse(!0),(e=function(t){var n,r;r=void 0,n=document.createDocumentFragment();while(r=t.next())t.hasPartialSubtree()?r=r.cloneNode(!1):t.remove(),t.hasPartialSubtree()&&r.appendChild(e(t.getSubtreeIterator())),n.appendChild(r);return n})(new t(n))},deleteContents:function(){var e,n;return n=this.cloneRange(),this.startContainer!==this.commonAncestorContainer&&this.setStartAfter(DOMUtils.findClosestAncestor(this.commonAncestorContainer,this.startContainer)),this.collapse(!0),(e=function(t){var n;n=[];while(t.next())n.push(t.hasPartialSubtree()?e(t.getSubtreeIterator()):t.remove());return n})(new t(n))},insertNode:function(e){var t;return DOMUtils.isDataNode(this.startContainer)?(DOMUtils.splitDataNode(this.startContainer,this.startOffset),this.startContainer.parentNode.insertBefore(e,this.startContainer.nextSibling)):(t=this.startContainer.childNodes[this.startOffset],t?this.startContainer.insertBefore(e,t):this.startContainer.appendChild(e)),this.setStart(this.startContainer,this.startOffset)},surroundContents:function(e){var t;return t=this.extractContents(),this.insertNode(e),e.appendChild(t),this.selectNode(e)},compareBoundaryPoints:function(t,n){var r,i,s,o;r=void 0,s=void 0,i=void 0,o=void 0;switch(t){case e.START_TO_START:case e.START_TO_END:r=this.startContainer,s=this.startOffset;break;case e.END_TO_END:case e.END_TO_START:r=this.endContainer,s=this.endOffset}switch(t){case e.START_TO_START:case e.END_TO_START:i=n.startContainer,o=n.startOffset;break;case e.START_TO_END:case e.END_TO_END:i=n.endContainer,o=n.endOffset}return r.sourceIndex<i.sourceIndex?-1:r.sourceIndex===i.sourceIndex?s<o?-1:s===o?0:1:1},cloneRange:function(){var t;return t=new e(this._document),t.setStart(this.startContainer,this.startOffset),t.setEnd(this.endContainer,this.endOffset),t},detach:function(){},toString:function(){return this._toTextRange().text},createContextualFragment:function(e){var t,n;t=(DOMUtils.isDataNode(this.startContainer)?this.startContainer.parentNode:this.startContainer).cloneNode(!1),t.innerHTML=e,n=this._document.createDocumentFragment();while(t.firstChild)n.appendChild(t.firstChild);return n}},t.prototype={range:null,_current:null,_next:null,_end:null,hasNext:function(){return!!this._next},next:function(){var e;return e=this._current=this._next,this._next=this._current&&this._current.nextSibling!==this._end?this._current.nextSibling:null,DOMUtils.isDataNode(this._current)&&(this.range.endContainer===this._current&&(e=e.cloneNode(!0)).deleteData(this.range.endOffset,e.length-this.range.endOffset),this.range.startContainer===this._current&&(e=e.cloneNode(!0)).deleteData(0,this.range.startOffset)),e},remove:function(){var e,t;return!DOMUtils.isDataNode(this._current)||this.range.startContainer!==this._current&&this.range.endContainer!==this._current?this._current.parentNode.removeChild(this._current):(t=this.range.startContainer===this._current?this.range.startOffset:0,e=this.range.endContainer===this._current?this.range.endOffset:this._current.length,this._current.deleteData(t,e-t))},hasPartialSubtree:function(){return!DOMUtils.isDataNode(this._current)&&(DOMUtils.isAncestorOrSelf(this._current,this.range.startContainer)||DOMUtils.isAncestorOrSelf(this._current,this.range.endContainer))},getSubtreeIterator:function(){var n;return n=new e(this.range._document),n.selectNodeContents(this._current),DOMUtils.isAncestorOrSelf(this._current,this.range.startContainer)&&n.setStart(this.range.startContainer,this.range.startOffset),DOMUtils.isAncestorOrSelf(this._current,this.range.endContainer)&&n.setEnd(this.range.endContainer,this.range.endOffset),new t(n)}},e}(),window.Range._fromTextRange=function(e,t){var n,r;return n=function(e,n,r){var i,s,o;s=t.createElement("a"),i=n.duplicate(),i.collapse(r),o=i.parentElement();for(;;){o.insertBefore(s,s.previousSibling),i.moveToElementText(s);if(!(i.compareEndPoints(r?"StartToStart":"StartToEnd",n)>0&&s.previousSibling))break}return i.compareEndPoints(r?"StartToStart":"StartToEnd",n)===-1&&s.nextSibling?(i.setEndPoint(r?"EndToStart":"EndToEnd",n),e[r?"setStart":"setEnd"](s.nextSibling,i.text.length)):e[r?"setStartBefore":"setEndBefore"](s),s.parentNode.removeChild(s)},r=new Range(t),n(r,e,!0),n(r,e,!1),r},document.createRange=function(){return new Range(document)},window.Selection=function(){var e;return e=function(e){var t;return this._document=e,t=this,e.attachEvent("onselectionchange",function(){return t._selectionChangeHandler()})},e.prototype={rangeCount:0,_document:null,_selectionChangeHandler:function(){return this.rangeCount=this._selectionExists(this._document.selection.createRange())?1:0},_selectionExists:function(e){return e.compareEndPoints("StartToEnd",e)!==0||e.parentElement().isContentEditable},addRange:function(e){var t,n;return t=this._document.selection.createRange(),n=e._toTextRange(),this._selectionExists(t)?(n.compareEndPoints("StartToStart",t)===-1&&(n.compareEndPoints("StartToEnd",t)>-1&&n.compareEndPoints("EndToEnd",t)===-1?t.setEndPoint("StartToStart",n):n.compareEndPoints("EndToStart",t)<1&&n.compareEndPoints("EndToEnd",t)>-1&&t.setEndPoint("EndToEnd",n)),t.select()):n.select()},removeAllRanges:function(){return this._document.selection.empty()},getRangeAt:function(e){var t;return t=this._document.selection.createRange(),this._selectionExists(t)?Range._fromTextRange(t,this._document):null},toString:function(){return this._document.selection.createRange().text}},e}(),window.getSelection=function(){var e;return e=new Selection(document),function(){return e}}()),jQuery.extend(Range.prototype,function(){var e,t,n,r,i;return t=function(e){return!e||!e.compareBoundaryPoints?!1:this.compareBoundaryPoints(this.START_TO_START,e)===-1&&this.compareBoundaryPoints(this.START_TO_END,e)===-1&&this.compareBoundaryPoints(this.END_TO_END,e)===-1&&this.compareBoundaryPoints(this.END_TO_START,e)===-1},e=function(e){return!e||!e.compareBoundaryPoints?!1:this.compareBoundaryPoints(this.START_TO_START,e)===1&&this.compareBoundaryPoints(this.START_TO_END,e)===1&&this.compareBoundaryPoints(this.END_TO_END,e)===1&&this.compareBoundaryPoints(this.END_TO_START,e)===1},n=function(e){return!e||!e.compareBoundaryPoints?!1:!this.beforeRange(e)&&!this.afterRange(e)},r=function(e){return!e||!e.compareBoundaryPoints?!1:this.compareBoundaryPoints(this.START_TO_START,e)===0&&this.compareBoundaryPoints(this.START_TO_END,e)===1&&this.compareBoundaryPoints(this.END_TO_END,e)===0&&this.compareBoundaryPoints(this.END_TO_START,e)===-1},i=function(){var e,t,n;t=this.commonAncestorContainer;while(t.nodeType===Node.TEXT_NODE)t=t.parentNode;return e=void 0,n=this,$.each(t.children,function(e,t){var r;return r=document.createRange(),r.selectNodeContents(t),t=n.betweenRange(r)}),$(e||t)},{beforeRange:t,afterRange:e,betweenRange:n,equalRange:r,getNode:i}}());var Selection;jQuery.browser.msie&&jQuery.browser.version<9?jQuery.extend(Selection.prototype,function(){var e,t;return e=function(){var e;return e=this._document.selection.createRange(),jQuery(e.parentElement())},t=function(e){var t;return t=this._document.body.createTextRange(),t.moveToElementText(e),t.select()},{getNode:e,selectNode:t}}()):(typeof Selection=="undefined"&&(Selection={},Selection.prototype=window.getSelection().__proto__),jQuery.extend(Selection.prototype,function(){var e,t;return e=function(){return this.rangeCount>0?this.getRangeAt(0).getNode():null},t=function(e){var t;return t=document.createRange(),t.selectNode(e[0]),this.removeAllRanges(),this.addRange(t)},{getNode:e,selectNode:t}}())),jQuery.browser.msie?jQuery.extend(Selection.prototype,function(){var e,t;return t=function(){var e,t,n;return e=jQuery("#bookmark"),e&&e.remove(),e=jQuery('<span id="bookmark">&nbsp;</span>'),t=jQuery("<div></div>").html(e),n=this._document.selection.createRange(),n.collapse(),n.pasteHTML(t.html())},e=function(){var e,t;e=jQuery("#bookmark");if(!e)return;return t=this._document.selection.createRange(),t.moveToElementText(e),t.collapse(),t.select(),e.remove()},{setBookmark:t,moveToBookmark:e}}()):jQuery.extend(Selection.prototype,function(){var e,t;return t=function(){var e;return e=jQuery("#bookmark"),e&&e.remove(),e=jQuery('<span id="bookmark">&nbsp;</span>'),this.getRangeAt(0).insertNode(e)},e=function(){var e,t;e=jQuery("#bookmark");if(!e)return;return t=document.createRange(),t.setStartBefore(e),this.removeAllRanges(),this.addRange(t),e.remove()},{setBookmark:t,moveToBookmark:e}}()),WysiHat.Editor={attach:function(e){var t,n;return n=e.attr("id")+"_editor",t=e.siblings("#"+n).first(),t.length===0&&(t=$('<div id="'+n+'" class="editor" contentEditable="true"></div>'),e.before(t)),t.html(WysiHat.Formatting.getBrowserMarkupFrom(e.val())),jQuery.extend(t,WysiHat.Commands),e.hide(),e.closest("form").submit(function(){return e.val(WysiHat.Formatting.getApplicationMarkupFrom(t))}),t}},WysiHat.BrowserFeatures=function(){var e,t,n,r,i;return e=function(e){var t,n;return t=void 0,n=void 0,t=$("<iframe></iframe>"),t.css({position:"absolute",left:"-1000px"}),t.onFrameLoaded(function(){return typeof t.contentDocument!="undefined"?n=t.contentDocument:typeof t.contentWindow!="undefined"&&typeof t.contentWindow.document!="undefined"&&(n=t.contentWindow.document),n.designMode="on",e(n),t.remove()}),$(document.body).insert(t)},n=function(e){var t,n;return e.body.innerHTML="",e.execCommand("insertparagraph",!1,null),n=void 0,t=e.body.childNodes[0],t&&t.tagName&&(n=t.tagName.toLowerCase()),n==="div"?r.paragraphType="div":e.body.innerHTML==="<p><br></p>"?r.paragraphType="br":r.paragraphType="p"},t=function(e){var t,n;return e.body.innerHTML="tab",e.execCommand("indent",!1,null),n=void 0,t=e.body.childNodes[0],t&&t.tagName&&(n=t.tagName.toLowerCase()),r.indentInsertsBlockquote=n==="blockquote"},r={},r.run=i=function(){if(r.finished)return;return e(function(e){return n(e),t(e),r.finished=!0})},r}(),WysiHat.Commands=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;return s=function(){return this.execCommand("bold",!1,null)},i=function(){return this.queryCommandState("bold")},O=function(){return this.execCommand("underline",!1,null)},A=function(){return this.queryCommandState("underline")},b=function(){return this.execCommand("italic",!1,null)},y=function(){return this.queryCommandState("italic")},N=function(){return this.execCommand("strikethrough",!1,null)},p=function(){var t,n,r,i;return $.browser.mozilla?(i=void 0,r=void 0,n=void 0,t=void 0,i=e.getSelection(),r=i.getRangeAt(0),n=i.getNode(),r.collapsed&&(r=document.createRange(),r.selectNodeContents(n),i.removeAllRanges(),i.addRange(r)),t=$("<blockquote></blockquote>"),r=i.getRangeAt(0),r.surroundContents(t)):this.execCommand("indent",!1,null)},x=function(){return this.execCommand("outdent",!1,null)},C=function(){return this.indentSelected()?this.outdentSelection():this.indentSelection()},h=function(){var t;return t=e.getSelection().getNode(),t.is("blockquote, blockquote *")},a=function(e){return this.execCommand("fontname",!1,e)},f=function(e){return this.execCommand("fontsize",!1,e)},o=function(e){return this.execCommand("forecolor",!1,e)},r=function(e){return $.browser.mozilla?this.execCommand("hilitecolor",!1,e):this.execCommand("backcolor",!1,e)},n=function(e){return this.execCommand("justify"+e)},t=function(){var t;return t=e.getSelection().getNode(),$(t).css("textAlign")},E=function(e){return this.execCommand("createLink",!1,e)},M=function(){var t;return t=e.getSelection().getNode(),this.linkSelected()&&e.getSelection().selectNode(t),this.execCommand("unlink",!1,null)},w=function(){var t;return t=e.getSelection().getNode(),t?t.get(0).tagName.toUpperCase()==="A":!1},l=function(e){return this.execCommand("formatblock",!1,e)},k=function(){var t,n;return n=void 0,t=void 0,n=e.getSelection(),t=n.getNode(),this.orderedListSelected()&&!t.is("ol li:last-child, ol li:last-child *")?n.selectNode(t.closest("ol")):this.unorderedListSelected()&&n.selectNode(t.closest("ul")),this.execCommand("insertorderedlist",!1,null)},m=function(){return this.toggleOrderedList()},S=function(){var t;return t=e.getSelection().getNode(),t?t.is('*[contenteditable=""] ol, *[contenteditable=true] ol, *[contenteditable=""] ol *, *[contenteditable=true] ol *'):!1},L=function(){var t,n;return n=void 0,t=void 0,n=e.getSelection(),t=n.getNode(),this.unorderedListSelected()&&!t.is("ul li:last-child, ul li:last-child *")?n.selectNode(t.closest("ul")):this.orderedListSelected()&&n.selectNode(t.closest("ol")),this.execCommand("insertunorderedlist",!1,null)},g=function(){return this.toggleUnorderedList()},_=function(){var t;return t=e.getSelection().getNode(),t?t.is('*[contenteditable=""] ul, *[contenteditable=true] ul, *[contenteditable=""] ul *, *[contenteditable=true] ul *'):!1},v=function(e){return this.execCommand("insertImage",!1,e)},d=function(t){var n;return $.browser.msie?(n=e.document.selection.createRange(),n.pasteHTML(t),n.collapse(!1),n.select()):this.execCommand("insertHTML",!1,t)},u=function(t,n,r){var i;i=this.commands[t];if(i)i.bind(this)(r);else try{e.document.execCommand(t,n,r)}catch(s){return null}return $(document.activeElement).trigger("field:change")},T=function(t){var n;n=this.queryCommands[t];if(n)return n();try{return e.document.queryCommandState(t)}catch(r){return null}},c=function(){var e,t;return t={},e=this,e.styleSelectors.each(function(n){var r;return r=e.selection.getNode(),t[n.first()]=$(r).css(n.last())}),t},{boldSelection:s,boldSelected:i,underlineSelection:O,underlineSelected:A,italicSelection:b,italicSelected:y,strikethroughSelection:N,indentSelection:p,outdentSelection:x,toggleIndentation:C,indentSelected:h,fontSelection:a,fontSizeSelection:f,colorSelection:o,backgroundColorSelection:r,alignSelection:n,alignSelected:t,linkSelection:E,unlinkSelection:M,linkSelected:w,formatblockSelection:l,toggleOrderedList:k,insertOrderedList:m,orderedListSelected:S,toggleUnorderedList:L,insertUnorderedList:g,unorderedListSelected:_,insertImage:v,insertHTML:d,execCommand:u,queryCommandState:T,getSelectedStyles:c,commands:{},queryCommands:{link:w,numbers:S,bullets:_},styleSelectors:{fontname:"fontFamily",fontsize:"fontSize",forecolor:"color",hilitecolor:"backgroundColor",backcolor:"backgroundColor"}}}(window),function(){var e,t,n;return e=function(e,t){var n,r,i,s;i=t.length,r=void 0,s=$("<"+e.tagName.toLowerCase()+"></"+e.tagName.toLowerCase()+">"),e=$(e),r=0;while(r<t.length)n=t[r],e.attr(n)&&s.attr(n,e.attr(n)),r++;return s},n=function(e,t){var n,r,i,s;i=$(e).children,r=i.length,n=void 0,n=0,s=[];while(n<r)t(i[n]),s.push(n++);return s},t=function(r,i,s,o){var u,a,f;a=r.parentNode;switch(r.nodeType){case Node.ELEMENT_NODE:f=r.tagName.toLowerCase();if(o)return u=r.cloneNode(!1),n(r,function(e){return u.appendChild(e),t(e,i,s,o)}),a.insertBefore(u,r);if(f in s)return u=e(r,s[f]),n(r,function(e){return u.appendChild(e),t(e,i,s,o)}),a.insertBefore(u,r);if(!(f in i))return n(r,function(e){return a.insertBefore(e,r),t(e,i,s,o)});break;case Node.COMMENT_NODE:return a.removeChild(r)}},jQuery.fn.sanitizeContents=function(e){var r,i,s,o;return r=$(this),s={},$.each((e.remove||"").split(","),function(e){return s[$.trim(e)]=!0}),i={},$.each((e.allow||"").split(","),function(e){var t,n,r;return n=$.trim(e).split(/[\[\]]/),r=n[0],t=$.grep(n.slice(1),function(e,t){return/./.test(e)}),i[r]=t}),o=e.skip,n(r,function(e){return t(e,s,i,o)}),r}}(),$(document).ready(function(){var e;return e=function(e,t){var n,r;n=$(t),t=n.get(0),r=void 0,n.attr("contentEditable")==="true"&&(r=n.html()),r=n.val();if(r&&t.previousValue!==r)return n.trigger("field:change"),t.previousValue=r},$('input,textarea,*[contenteditable=""],*[contenteditable=true]').keyup(e)}),function(){var e,t,n;return n=function(e,t){var n;return n=function(){return e.readyState==="complete"?($(e).unbind("readystatechange",n),t(),!0):!1},$(e).bind("readystatechange",n),n()},e=function(e){var t,r,i,s;return i=function(){var t;if(t)return;return t=!0,r&&r.stop(),e.trigger("frame:loaded")},e=$(e),t=e.get(0),s=void 0,r=void 0,s=!1,window.addEventListener&&(r=$(document).bind("DOMFrameContentLoaded",function(t){if(e===$(this))return i()})),e.load(function(){var t;return t=void 0,typeof e.contentDocument!="undefined"?t=e.contentDocument:typeof e.contentWindow!="undefined"&&typeof e.contentWindow.document!="undefined"&&(t=e.contentWindow.document),n(t,i)}),e},t=function(e,t){return e.bind("frame:loaded",t),e.observeFrameContentLoaded()},jQuery.fn.observeFrameContentLoaded=e,jQuery.fn.onFrameLoaded=t}(),$(document).ready(function(){var e,t,n;return e=$(document),"selection"in document&&"onselectionchange"in document?(n=function(){var e,t;return t=document.selection.createRange(),e=t.parentElement(),$(e).trigger("selection:change")},e.bind("selectionchange",n)):(t=void 0,n=function(){var e,n,r,i;e=document.activeElement,n=e.tagName.toLowerCase();if(n==="textarea"||n==="input")return t=null,$(e).trigger("selection:change");i=window.getSelection();if(i.rangeCount<1)return;r=i.getRangeAt(0);if(r&&r.equalRange(t))return;t=r,e=r.commonAncestorContainer;while(e.nodeType===Node.TEXT_NODE)e=e.parentNode;return $(e).trigger("selection:change")},e.mouseup(n),e.keyup(n))}),WysiHat.Formatting=function(){var e,t,n;return e={},n={},t={},{getBrowserMarkupFrom:function(e){var t,n,r,i,s;return s=function(e,t){return $(e).replaceWith('<span style="'+t+'" class="Apple-style-span">'+e.innerHTML+"</span>")},i=function(){return t.find("strong").each(function(e,t){return s(t,"font-weight: bold")})},r=function(){return t.find("em").each(function(e,t){return s(t,"font-style: italic")})},n=function(){return t.find("div").each(function(e,t){return $(t).replaceWith("<p>"+t.innerHTML+"</p>")})},t=$("<div>"+e+"</div>"),$.browser.webkit||$.browser.mozilla?(i(),r()):($.browser.msie||$.browser.opera)&&n(),t.html()},getApplicationMarkupFrom:function(r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;return C=function(e){var t,n,r,i,s;n=e.length,r=void 0,i=void 0,t=void 0,t=0,s=[];while(t<n)r=e[t],r.nodeType===1?(i=r.tagName.toLowerCase(),S(i,r),C(r.childNodes),o(i)):r.nodeType===3&&T(r.nodeValue),s.push(t++);return s},S=function(r,o){var u,a;if(a===e)if(p(r)){d(o)&&i($("<br />").get(0)),l();if(g(r))return u=h(r),a=n}else{if(!v(r))return s(r,o);v(c())&&(x.parentNode.removeChild(x),l()),i(o.cloneNode(!1));if(!x.previousNode)return l()}else if(a===n){if(y(r))return a=t}else if(a===t){if(v(r))return i(o.cloneNode(!1));if(!p(r))return s(r,o)}},o=function(r){var i,s,o;if(o===e){m(r)&&l();if(b!==s)return s=s.parentNode}else if(o===n){if(g(r))return i=N,o=e}else if(o===t){y(r)&&(l(),o=n);if(b!==s)return s=s.parentNode}},p=function(e){return m(e)||g(e)},m=function(e){return e==="p"||e==="div"},g=function(e){return e==="ol"||e==="ul"},y=function(e){return e==="li"},v=function(e){return e==="br"},d=function(e){return e.tagName.toLowerCase()==="p"&&e.childNodes.length===0},T=function(e){return i(document.createTextNode(e))},s=function(e,t){var n,r;return n=t.cloneNode(!1),e==="span"&&($(t).css("fontWeight")==="bold"?n=$("<strong></strong>").get(0):$(t).css("fontStyle")==="italic"&&(n=$("<em></em>").get(0))),i(n),r=n},i=function(e){var t,r,i;if(E!==n)return t||(t=r=a()),i=e,r.appendChild(e)},c=function(){if(x&&x.nodeType===1)return x.tagName.toLowerCase()},l=function(){var e,t;if(e&&e.childNodes.length)return u.appendChild(e),e=t=null},a=function(){if(E===e)return $("<div></div>").get(0);if(E===t)return $("<li></li>").get(0)},h=function(e){var t;return t=$("<"+e+"></"+e+">").get(0),N.appendChild(t),t},f=r.get(0),E=e,N=void 0,u=void 0,b=void 0,w=void 0,x=void 0,N=u=$("<div></div>").get(0),C(f.childNodes),l(),N.innerHTML}}}(),WysiHat.Toolbar=function(){function e(e){this.editor=e,this.element=this.createToolbarElement(),this.addButtonSet()}return e.prototype.createToolbarElement=function(){var e;return e=$('<div class="editor_toolbar"></div>'),this.editor.before(e),e},e.prototype.addButtonSet=function(){var e,t=this;return e=[{name:"Bold",label:"<strong>Bold</strong>",hotkey:"meta+b ctrl+b"},{name:"Italic",label:"<em>Italic</em>",hotkey:"meta+i ctrl+i"},{name:"Underline",label:"<u>Underline</u>",hotkey:"meta+u ctrl+u"},{name:"Bullets",label:"<i class='icon-list-ul'></i> Bullets",handler:function(e){return e.toggleUnorderedList()}},{name:"Numbers",label:"<i class='icon-list-ol'></i> Numbers",handler:function(e){return e.toggleOrderedList()}}],$(e).each(function(e,n){return t.addButton(n)})},e.prototype.addButton=function(e,t){var n,r;return e.name||(e.name=e.label.toLowerCase()),r=e.name,n=this.createButtonElement(this.element,e),t=this.buttonHandler(r,e),this.observeButtonClick(n,t),t=this.buttonStateHandler(r,e),this.observeStateChanges(n,r,t)},e.prototype.createButtonElement=function(e,t){var n;return n=$('<a class="btn btn-mini" href="#">'+t.label+"</a>"),e.append(n),t.hotkey&&this.editor.bind("keydown",t.hotkey,function(e){return n.click(),e.preventDefault()}),n},e.prototype.buttonHandler=function(e,t){return t.handler?t.handler:t.handler?t.handler:function(t){return t.execCommand(e)}},e.prototype.observeButtonClick=function(e,t){var n=this;return $(e).click(function(){return t(n.editor),$(document.activeElement).trigger("selection:change"),!1})},e.prototype.buttonStateHandler=function(e,t){return t.query?t.query:t.query?t.query:function(t){return t.queryCommandState(e)}},e.prototype.observeStateChanges=function(e,t,n){var r,i=this;return r=void 0,this.editor.bind("selection:change",function(){var s;s=n(i.editor);if(s!==r)return r=s,i.updateButtonState(e,t,s)})},e.prototype.updateButtonState=function(e,t,n){return n?$(e).addClass("active"):$(e).removeClass("active")},e}();